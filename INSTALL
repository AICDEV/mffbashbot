Harrys My Free Farm Bash Bot (MFF Bash Bot)
-------------------------------------------

Installation
------------

A) Debian-basierte Distributionen
B) Windows (weiter unten)

A)
Grundsätzliches Linux-Wissen wird an dieser Stelle vorausgesetzt.
Solltest Du über dieses Wissen nicht verfügen, ist es empfehlenswert, sich
dieses anzueignen oder im Zweifel von einer Installation des Bots abzusehen.
Erklärungen darüber, wie man sich z.B. anmeldet, oder Dateien editiert sind
nicht Teil dieser Dokumentation.

Pakete wie sudo, sed, wget, (p)grep und so weiter sollten schon installiert
sein. Und wie der Name schon vermuten lässt, muss auch die bash an Bord sein. ;)

Wir benötigen einige neue Pakete:
harry@testbox:~$ sudo apt-get install jq lighttpd php5-cgi screen logrotate cron unzip

Nachdem diese Pakete idealerweise erfolgreich installiert wurden, widmen wir uns
zunächst der Installation des Bots.
Dazu erzeugen wir die erforerliche Grundstruktur im Dateisystem. Sie ist im
Gesamtpaket enthalten und beinhaltet eine komplette Farm - auch Teile, die ggf.
noch nicht freigespielt sind.
harry@testbox:~$ cd
harry@testbox:~$ wget --no-check-certificate "https://github.com/HackerHarry/mffbashbot/archive/master.zip"
harry@testbox:~$ unzip master.zip
harry@testbox:~$ mv mffbashbot-master mffbashbot

Die jetzt erstellte Grundstruktur beinhaltet u.a. die Information darüber,
was der Bot wo erledigen soll, den Bot selbst und die GUI.

harry@testbox:~$ cd ~/mffbashbot
harry@testbox:~/mffbashbot$ chmod +x mffbashbot.sh

Jetzt müssen wir Rechte anpassen, da hier später der Prozess
des Webservers schreiben können muss:
harry@testbox:~/mffbashbot$ find . -type d -exec chmod 775 {} +
harry@testbox:~/mffbashbot$ find . -type f -exec chmod 664 {} +
Paranoiker können naklar auch 770 und 660 verwenden ;)

Hier kann der dummy ordner bereits umbenannt werden. Der neue Name hängt vom
Spielernamen bei My Free Farm ab. Wenn Du Dich als Benutzer 'hanswurst' bei MFF
anmeldest, benennst Du den dummy Ordner in hanswurst um:
harry@testbox:~/mffbashbot$ mv dummy hanswurst

Davon ausgehend, dass euer Webserver als 'www-data' läuft, passen wir die
Gruppenrechte an.
harry@testbox:~$ grep server.username /etc/lighttpd/lighttpd.conf
server.username             = "www-data"
harry@testbox:~$ sudo nano /etc/group

Mein Bot-Benutzer ist in diesem Beispiel 'harry' mit gleichlautender Gruppe.
Ergo sieht mein Eintrag in der group Datei so aus:
harry:x:1000:www-data

Nun konfgurieren wir den lighttpd Webserver. Zunächst diesen Codeblock ans
ende der /etc/lighttpd/lighttpd.conf setzen:

harry@testbox:~$ echo '
fastcgi.server = ( ".php" => ((
                     "bin-path" => "/usr/bin/php5-cgi",
                     "socket" => "/tmp/php.socket"
                 )))
# source of all modification in order to make php5 run under
# lighttpd http://www.howtoforge.com/lighttpd_mysql_php_debian_etch ' | sudo tee --append /etc/lighttpd/lighttpd.conf > /dev/null

Weiter gehts mit der Konfiguration des Webservers:
harry@testbox:~$ cd /etc/lighttpd/conf-enabled/
harry@testbox:/etc/lighttpd/conf-enabled$ ls
harry@testbox:/etc/lighttpd/conf-enabled$ sudo ln -s ../conf-available/10-accesslog.conf 10-accesslog.conf
harry@testbox:/etc/lighttpd/conf-enabled$ sudo ln -s ../conf-available/10-fastcgi.conf 10-fastcgi.conf
harry@testbox:/etc/lighttpd/conf-enabled$ sudo /etc/init.d/lighttpd restart
[ ok ] Restarting lighttpd (via systemctl): lighttpd.service.

Jetzt wird es Zeit, die GUI zur Botkontrolle zu installieren.

harry@testbox:~$ sudo su
root@testbox:/home/harry# cd /var/www/html/
root@testbox:/var/www/html# mv /home/harry/mffbashbot/mffbashbot-GUI ./mffbashbot

Hier kannst Du noch den Besitzer der Ordner und Dateien anpassen, wenn
Du das wünschst. Das obige Beispiel kann dazu als Referenz dienen.

root@testbox:/var/www/html# cd mffbashbot/script/
root@testbox:/var/www/html/mffbashbot/script# chmod +x wakeupthebot.sh logonandgetfarmdata.sh
root@testbox:/var/www/html/mffbashbot/script# cd ..
root@testbox:/var/www/html/mffbashbot# nano gamepath.php

In der 'gamepath.php' muss der Pfad zum Botordner angepasst werden.

root@testbox:/var/www/html/mffbashbot# nano index.php

In der 'index.php' muss der Pfad in der system() Funktion angepasst werden.
Ziel ist (naklar) euer Botordner.

Damit der Webserver die Zwangspause des Bots auf Wunsch des Benutzers
unterbrechen darf, muss für 'sudo' ein passender Eintrag her:
root@testbox:/var/www/html/mffbashbot# exit
harry@testbox:~$ echo 'www-data ALL=(ALL) NOPASSWD: /bin/kill' | sudo tee /etc/sudoers.d/www-data-kill-cmd > /dev/null

Standardmässig wird ein Bot-Log erzeugt.
Optional, aber der Übersicht förderlich, kann man nun noch logrotate für die
Rotation des Bot-Logs einrichten.

harry@testbox:~$ echo '/home/harry/mffbashbot/*/mffbot.log
{
        rotate 6
        daily
        su harry harry
        missingok
        notifempty
        delaycompress
        compress
} ' | sudo tee /etc/logrotate.d/mffbashbot > /dev/null

Auch hier muss der Pfad ebenso wie die 'su' Zeile angepasst werden.

Im Prinzip ist der Bot nun fertig installiert.
Wie man den Bot startet, steht in der MANUAL

Die GUI zum steuern des Bots erreichst Du dort, wo Dein lighttpd Webserver
läuft. Dort unter http://IP-oder-Hostname/mffbashbot

Wenn Du mehr als eine Farm betreiben möchtest, kannst Du das selbstverständlich
tun. Dazu kopierst Du einfach eine vorhandene Farm als Vorlage für die neue
Farm. Im folgenden Beispiel ist der Name der neuen Farm 'inge05' :

harry@testbox:~$ cd ~/mffbashbot
harry@testbox:~/mffbashbot$ cp -a dummy/ inge05
--------------------------------------------------------------------------------
B)
Getestet unter Windows 7 SP1 x64

Wir arbeiten hier mit der x86 Variante von Cygwin, da diese den Grossteil der
Windows-Versionen abdeckt. Wer unbedingt 64bit installieren will, möge die
notwendigen Anpassungen bitte selbst vornehmen.

Alle folgenden Befehle werden OHNE Anführungszeichen eingegeben.

https://cygwin.com/setup-x86.exe herunterladen (und MERKEN wo's gespeichert ist)
Windows-Taste drücken, dann "cmd" eingeben, dann ENTER (Eingabetaste) drücken.
"cd <Ordner wohin setup-x86.exe heruntergeladen wurde>" eingeben, ENTER
Wenn setup-x86.exe nach C:\Users\Harry\Downloads heruntergeladen wurde,
lautet der Befehl "cd c:\Users\Harry\Downloads".
Jetzt folgendes eingeben, oder per kopieren-und-einfügen ins CMD Fenster einsetzen:
"setup-x86.exe -q -s http://linux.rz.ruhr-uni-bochum.de/cygwin/ -a x86 -l C:\cygtemp -R C:\cygwin -P nano,jq,php,php-jsonc,wget,lighttpd,unzip,screen,perl_base"
mit ENTER bestätigen, die erweiterten Rechte abnicken, und dann dem Setup-Prozess zuschauen :)
Hier werden ca. 44MB aus dem Internet geladen.
Irgendwann isser dann fertig und das Setup-Fenster schliesst sich automatisch.
Das CMD Fenster kannst auch zumachen, wenn'd willst.
Auf Deiner Arbeitsoberfläche (dem Desktop) findest Du nun eine neue Ikone namens
"Cygwin Terminal" - da einen Doppelklick drauf machen, dann öffnet sich ein
neues Fenster.

Mir war der Text viel zu klein, also klickte ich auf das schwarz-grüne
Eck-Symbol, dann auf "Options", dann "Text" und wählte dort über den "Select..."
Knopf eine grössere Schriftart. Für mich war das Courier New / bold / 18.
Übrigens: Willkommen in der Unix-Welt! :-)

Noch immer in dem neuen, "fremden" Fenster gibst nu folgendes ein:
"wget --no-check-certificate https://raw.githubusercontent.com/HackerHarry/mffbashbot/master/install-win.sh"
Ab hier erledigt das heruntergeladene Skript einige Arbeit. Starte das Skript:
"./install-win.sh" und ENTER naklar.
Am Ende könnte eure Firewall über den lighttpd prozess meckern; falls Dir eine
Ausnahme angeboten wird, musst Du diese naklar annehmen.

Jetzt müssen wir einen Ordner umbenennen. Unter *nix macht man
das mit "mv". Der neue Name richtet sich nach Deinem ANMELDENAMEN
bei My Free Farm. Wenn Du Dich mit "susi0815" anmeldest, lauten Deine Befehle
"cd ~/mffbashbot", dann
"mv dummy susi0815" und mit der Eingabetaste bestätigen.

Wie der Bot gestartet wird, steht in der MANUAL Datei.

Deinen Bot kannst Du nun mit Deinem Browser (unterstützt wird meinerseits nur
Firefox) konfigurieren. Die Adresse lautet http://localhost/mffbashbot

Wer mehrere Farmen betreiben will, findet in der MANUAL Datei wertvolle Infos.

Wenn Du Deinen Rechner neu startest, wirst Du auch den Webserver und Deinen
Bot neu starten müssen!
Im "Cygwin Terminal" mit "/usr/sbin/lighttpd -f /etc/lighttpd/lighttpd.conf"
den Webserver, den Bot wie im MANUAL beschrieben neu starten.
