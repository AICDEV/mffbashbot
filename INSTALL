Harrys My Free Farm Bash Bot
----------------------------

Installation
------------

A) Debian-based distributions
B) Windows (further down)

A)
You need at least basic Linux knowledge at this point.
If you don't know about basic Linux stuff, you can either try and learn it or
refrain from installing the bot. I might write some sort of setup script in the
future. You surely understand i can't explain here how to log on to Linux or
how to edit files.

Packets like sudo, sed, wget, (p)grep etc. should be already on your box.
And as the product name suggests, you'll also need the bash ;)

We need to install a few packets:
harry@testbox:~$ sudo apt-get install jq lighttpd php5-cgi screen logrotate cron unzip

After a (hopefully) successful installation, we'll turn to installing the bot.
For that, we need a basic structure in the file system. That scructure can be
found in the below mentioned archive. It contains an entire farm, which includes
parts that might not be accassible to you yet.
harry@testbox:~$ cd
harry@testbox:~$ wget --no-check-certificate "https://github.com/HackerHarry/mffbashbot/archive/master.zip"
harry@testbox:~$ unzip master.zip
harry@testbox:~$ mv mffbashbot-master mffbashbot

The scrutcture contains, amongst other things, information on what the bot's
supposed to do and where, as well as the bots GUI.

harry@testbox:~$ cd ~/mffbashbot
harry@testbox:~/mffbashbot$ chmod +x mffbashbot.sh

We need to adjust file system rights so the web server process can write here:
harry@testbox:~/mffbashbot$ find . -type d -exec chmod 775 {} +
harry@testbox:~/mffbashbot$ find . -type f -exec chmod 664 {} +
Paranoiacs can use 770 and 660 ;)

The newly created 'dummy' folder can be renamed here. The new name depends on
how you log on to the My Free Farm website. If you log on as 'hanswurst', simply
rename the 'dummy' folder to 'hanswurst':
harry@testbox:~/mffbashbot$ mv dummy hanswurst

While we're at it: The server-no., password and language need to be set once
per farm. Make sure to leave the white spaces in front and behind the equal
sign. Make also sure you don't use the exclamation mark (!) for your first
character of your password. Please also don't use the single quote (') _within_
your password.
Edit the config.ini:
harry@testbox:~/mffbashbot$ nano hanswurst/config.ini
to reflect your account settings.
--- snip ---
lang = 'en'
server = 2
password = 's3cRet!'
--- snip ---

Assuming your web server runs as 'www-data' we need to adjust group rights.
harry@testbox:~$ grep server.username /etc/lighttpd/lighttpd.conf
server.username             = "www-data"
harry@testbox:~$ sudo nano /etc/group

The Linux user name i use to operate my bot is 'harry', using also 'harry' for
the primary group.
My group entry looks like this:
harry:x:1000:www-data

Let's now configure the lighttpd web server. Copy and paste this code block to
the end of your /etc/lighttpd/lighttpd.conf:

harry@testbox:~$ echo '
fastcgi.server = ( ".php" => ((
                     "bin-path" => "/usr/bin/php5-cgi",
                     "socket" => "/tmp/php.socket"
                 )))
# source of all modification in order to make php5 run under
# lighttpd http://www.howtoforge.com/lighttpd_mysql_php_debian_etch ' | sudo tee --append /etc/lighttpd/lighttpd.conf > /dev/null

Some more web server configuration:
harry@testbox:~$ cd /etc/lighttpd/conf-enabled/
harry@testbox:/etc/lighttpd/conf-enabled$ ls
harry@testbox:/etc/lighttpd/conf-enabled$ sudo ln -s ../conf-available/10-accesslog.conf 10-accesslog.conf
harry@testbox:/etc/lighttpd/conf-enabled$ sudo ln -s ../conf-available/10-fastcgi.conf 10-fastcgi.conf
harry@testbox:/etc/lighttpd/conf-enabled$ sudo /etc/init.d/lighttpd restart
[ ok ] Restarting lighttpd (via systemctl): lighttpd.service.

We will now install the bots GUI.

harry@testbox:~$ sudo su
root@testbox:/home/harry# cd /var/www/html/
root@testbox:/var/www/html# mv /home/harry/mffbashbot/mffbashbot-GUI ./mffbashbot

If you wish, you can adjust ownership for files and folders. Use the above
mentioned command as a reference.

root@testbox:/var/www/html# cd mffbashbot/script/
root@testbox:/var/www/html/mffbashbot/script# chmod +x wakeupthebot.sh logonandgetfarmdata.sh
root@testbox:/var/www/html/mffbashbot/script# cd ..
root@testbox:/var/www/html/mffbashbot# nano gamepath.php

In 'gamepath.php' adjust the path to the bots folder.

In order to allow the web server's process to force an iteration of the bot,
you need to add the proper entry for 'sudo':
root@testbox:/var/www/html/mffbashbot# exit
harry@testbox:~$ echo 'www-data ALL=(ALL) NOPASSWD: /bin/kill' | sudo tee /etc/sudoers.d/www-data-kill-cmd > /dev/null

Bot log file creation is set as default.
So optionally, you can set up logrotate to take care of log rotation.
Adjust the path accordingly.

harry@testbox:~$ echo '/home/harry/mffbashbot/*/mffbot.log
{
        rotate 6
        daily
        su harry harry
        missingok
        notifempty
        delaycompress
        compress
} ' | sudo tee /etc/logrotate.d/mffbashbot > /dev/null

Adjust also the file owner in the 'su' line.

Congrats: The bot is now installed.
Find info on how to start the bot in the MANUAL file.

You can access the bots GUI where you've installed your web server.
Just use http://IP-or-Hostname/mffbashbot

If you want to operate more than one farm, you can use an existing farm as a
template. The new farm's name in the example is 'inge05' :

harry@testbox:~$ cd ~/mffbashbot
harry@testbox:~/mffbashbot$ cp -a dummy/ inge05
--------------------------------------------------------------------------------
B)
Tested with Windows 7 SP1 x64

We'll be working with the x86 variant of Cygwin, since this should work with
most Windows versions. If you must use Cygwin x64, you'll be on your own.

Enter all following commands WITHOUT double quotes.

Download https://cygwin.com/setup-x86.exe and remember where you put it.
Press the Windows key, enter "cmd" then press ENTER.
"cd <to where you've downloaded setup-x86.exe to>", ENTER
If you saved setup-x86.exe in C:\Users\Harry\Downloads, your command would be
"cd c:\Users\Harry\Downloads".
Now copy and paste the following command into your CMD Window:
"setup-x86.exe -q -s http://linux.rz.ruhr-uni-bochum.de/cygwin/ -a x86 -l C:\cygtemp -R C:\cygwin -P nano,jq,php,php-jsonc,wget,lighttpd,unzip,screen,perl_base"
hit ENTER, confirm the elevated rights, and watch the progress bar :)
Download size will be around 44MB.
After setup completes, the setup window should close automagically.
Close the CMD window, if you wish.
On your deskop you'll find an icon labelled "Cygwin Terminal" - double click it,
and a new window opens.

To me, the font was way too small. So i changed the font size by clicking the
black and green symbol (top left corner), then "Options", then "Text", finally
chose via the "Select..." button a larger font. In my case
Courier New / bold / 18.
By the way: Welcome to the Unix-World! :-)

Tip: You can copy n paste stuff to the Cygwin window using the right mouse
button.
Still in that new and "strange" window, enter:
"wget --no-check-certificate https://raw.githubusercontent.com/HackerHarry/mffbashbot/master/install-win.sh"
Change it to "executable":
"chmod +x install-win.sh"
This script does most of the work for you. Just enter:
"./install-win.sh" and hit ENTER.
If your firewall complains at the end, you'll want to approve an exception
for the web servers process.

Now, we need to rename a folder. This can be done using the "mv" command.
The new name depends on how you log on to the My Free Farm website.
If you log on as 'susi0815', just enter
"cd ~/mffbashbot", then
"mv dummy susi0815" and finally ENTER.

You also need to configure the password, server-no. and language. See the
Linux-install section for details.

The MANUAL file gives you an insight on how to start the bot.

Configure your bot using your web browser (I only support Mozilla Firefox).
The address is http://localhost/mffbashbot

If you want to operate more than one farm, find some info on that in the
MANUAL file.

Important:
If you restart your computer, you'll have to restart the web servers process
as well! 
In "Cygwin Terminal" use "/usr/sbin/lighttpd -f /etc/lighttpd/lighttpd.conf"
to start the web server. The bot is (re)started as explained in the MANUAL.
